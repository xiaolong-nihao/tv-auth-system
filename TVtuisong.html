<!DOCTYPE html>
<html>
<head>
    <title>ç”µè§†æ¿€æ´»ç æ¨é€</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { color: #1890ff; margin-bottom: 10px; }
        .header p { color: #666; }
        
        .info-card { background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px; border-left: 4px solid #1890ff; }
        .info-item { display: flex; margin-bottom: 10px; }
        .info-label { width: 100px; color: #666; }
        .info-value { flex: 1; color: #333; font-weight: bold; }
        
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; }
        .input-group input, .input-group textarea { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid #e8e8e8; 
            border-radius: 8px; 
            font-size: 16px; 
            transition: all 0.3s; 
            resize: none;
            overflow: hidden;
            min-height: 60px;
            max-height: 200px;
            line-height: 1.5;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .input-group input:focus, .input-group textarea:focus { 
            border-color: #1890ff; 
            outline: none; 
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }
        
        .code-info {
            margin-top: 8px;
            font-size: 14px;
            color: #666;
            text-align: right;
        }
        
        /* æ¿€æ´»ç æ ·å¼çŠ¶æ€ */
        .highlight-code {
            background: linear-gradient(90deg, #f0f7ff, #e6f7ff);
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }
        .code-valid { border-color: #52c41a !important; }
        .code-invalid { border-color: #ff4d4f !important; }
        .code-warning { border-color: #faad14 !important; }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .scrollable {
            overflow-y: auto !important;
        }
        .scrollable::-webkit-scrollbar {
            width: 6px;
        }
        .scrollable::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .scrollable::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        .scrollable::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .btn { 
            display: block; 
            width: 100%; 
            padding: 18px; 
            background: linear-gradient(135deg, #1890ff, #096dd9); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 18px; 
            font-weight: bold; 
            cursor: pointer; 
            margin: 15px 0; 
            text-align: center;
        }
        .btn:hover { opacity: 0.9; }
        .btn.secondary { background: linear-gradient(135deg, #52c41a, #389e0d); }
        .btn.warning { background: linear-gradient(135deg, #faad14, #d48806); }
        .btn:disabled { 
            background: linear-gradient(135deg, #cccccc, #aaaaaa);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .result { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 8px; 
            display: none; 
            line-height: 1.6;
        }
        .success { background: #f6ffed; border: 1px solid #b7eb8f; color: #52c41a; }
        .error { background: #fff2f0; border: 1px solid #ffccc7; color: #ff4d4f; }
        .info { background: #e6f7ff; border: 1px solid #91d5ff; color: #1890ff; }
        
        .loading { text-align: center; padding: 30px; display: none; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #1890ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .tips { 
            background: #fff7e6; 
            border: 1px solid #ffd591; 
            border-radius: 8px; 
            padding: 15px; 
            margin-top: 20px; 
            color: #d46b08; 
            font-size: 14px; 
            line-height: 1.6;
        }
        
        .hidden { display: none; }
        
        .multi-code-notice {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 6px;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 14px;
            color: #1890ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“º ç”µè§†æ¿€æ´»ç æ¨é€</h1>
            <p>æ‰«ç åè‡ªåŠ¨è¿›å…¥æ­¤é¡µé¢ï¼Œè¾“å…¥æ¿€æ´»ç ä¸€é”®æ¨é€</p>
        </div>
        
        <div class="info-card">
            <h3>è®¾å¤‡ä¿¡æ¯</h3>
            <div class="info-item">
                <div class="info-label">ç”µè§†IP:</div>
                <div class="info-value" id="tv-ip">æ­£åœ¨è·å–...</div>
            </div>
            <div class="info-item">
                <div class="info-label">ä¼šè¯ID:</div>
                <div class="info-value" id="session-id">æ­£åœ¨è·å–...</div>
            </div>
            <div class="info-item">
                <div class="info-label">çŠ¶æ€:</div>
                <div class="info-value" id="status">
                    <span style="color: #faad14;">ç­‰å¾…è¿æ¥...</span>
                </div>
            </div>
        </div>
        
        <div class="input-group">
            <label for="activation-code">æ¿€æ´»ç </label>
            <textarea 
                id="activation-code" 
                rows="1"
                placeholder="è¯·ç²˜è´´ä½ çš„é•¿æ¿€æ´»ç ï¼ˆä»æ¿€æ´»ç ç”Ÿæˆå·¥å…·å¤åˆ¶ï¼‰&#10;æ”¯æŒå¤šè¡Œè¾“å…¥ï¼Œæ¯è¡Œä¸€ä¸ªæ¿€æ´»ç "
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false">
            </textarea>
            <div class="code-info">
                <span id="char-count">0</span> ä¸ªå­—ç¬¦
                <span id="line-count" style="margin-left: 15px;">1 è¡Œ</span>
            </div>
            <div id="multi-code-notice" class="multi-code-notice hidden">
                ğŸ“ æ£€æµ‹åˆ°å¤šè¡Œæ¿€æ´»ç ï¼Œå°†æŒ‰é¡ºåºå‘é€åˆ°ç”µè§†
            </div>
        </div>
        
        <button class="btn" onclick="sendActivation()" id="send-btn">
            ğŸš€ æ¨é€æ¿€æ´»ç åˆ°ç”µè§†
        </button>
        
        <button class="btn secondary" onclick="testConnection()">
            ğŸ” æµ‹è¯•ç”µè§†è¿æ¥
        </button>
        
        <div id="result" class="result"></div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loading-text">å¤„ç†ä¸­...</p>
        </div>
        
        <div class="tips">
            <strong>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</strong>
            <p>1. ç¡®ä¿æ‰‹æœºå’Œç”µè§†åœ¨åŒä¸€WiFiç½‘ç»œ</p>
            <p>2. ç”µè§†éœ€ä¿æŒæ¿€æ´»ç•Œé¢å¼€å¯</p>
            <p>3. æ¿€æ´»ç åªä½¿ç”¨ä¸€æ¬¡ï¼Œå‘é€åè¯·å‹¿é‡å¤</p>
            <p>4. æ”¯æŒå¤šè¡Œæ¿€æ´»ç ï¼Œæ¯è¡Œä¸€ä¸ªï¼ŒæŒ‰è¡Œé¡ºåºå‘é€</p>
            <p>5. æ ‡å‡†æ¿€æ´»ç é•¿åº¦ï¼š16-32ä½å­—æ¯æ•°å­—ç»„åˆ</p>
        </div>
    </div>

    <script>
        // è§£æURLå‚æ•°
        function getUrlParams() {
            const params = {};
            const query = window.location.search.substring(1);
            const pairs = query.split('&');
            
            for (let pair of pairs) {
                const [key, value] = pair.split('=');
                if (key && value) {
                    params[decodeURIComponent(key)] = decodeURIComponent(value);
                }
            }
            return params;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = 'result ' + type;
            resultDiv.style.display = 'block';
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }
        
        // æ˜¾ç¤ºåŠ è½½
        function showLoading(text) {
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('send-btn').disabled = true;
        }
        
        // éšè—åŠ è½½
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('send-btn').disabled = false;
        }
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, color) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<span style="color: ${color};">${message}</span>`;
        }
        
        // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬æ¡†é«˜åº¦
        function autoResizeTextarea() {
            const textarea = document.getElementById('activation-code');
            const charCount = document.getElementById('char-count');
            const lineCount = document.getElementById('line-count');
            const multiCodeNotice = document.getElementById('multi-code-notice');
            
            // é‡ç½®é«˜åº¦
            textarea.style.height = 'auto';
            
            // è®¡ç®—å†…å®¹é«˜åº¦
            const scrollHeight = textarea.scrollHeight;
            const minHeight = 60; // æœ€å°é«˜åº¦
            const maxHeight = 300; // å¢åŠ æœ€å¤§é«˜åº¦
            
            // é™åˆ¶é«˜åº¦èŒƒå›´
            let newHeight = Math.max(minHeight, Math.min(scrollHeight, maxHeight));
            
            // è®¾ç½®æ–°é«˜åº¦
            textarea.style.height = newHeight + 'px';
            
            // å¦‚æœè¶…è¿‡æœ€å¤§é«˜åº¦ï¼Œæ˜¾ç¤ºæ»šåŠ¨æ¡
            if (scrollHeight > maxHeight) {
                textarea.classList.add('scrollable');
            } else {
                textarea.classList.remove('scrollable');
            }
            
            // æ›´æ–°å­—ç¬¦è®¡æ•°
            const content = textarea.value;
            const charNum = content.length;
            charCount.textContent = charNum;
            
            // è®¡ç®—è¡Œæ•°ï¼ˆè¿‡æ»¤ç©ºè¡Œï¼‰
            const lines = content.split('\n').filter(line => line.trim()).length || 1;
            lineCount.textContent = lines + ' è¡Œ';
            
            // æ˜¾ç¤º/éšè—å¤šè¡Œæ¿€æ´»ç æç¤º
            if (lines > 1) {
                multiCodeNotice.classList.remove('hidden');
            } else {
                multiCodeNotice.classList.add('hidden');
            }
            
            // æ ¹æ®å­—ç¬¦æ•°æ”¹å˜æ ·å¼
            updateCodeStyle(charNum, content);
            
            return lines;
        }
        
        // æ ¹æ®æ¿€æ´»ç å†…å®¹æ›´æ–°æ ·å¼
        function updateCodeStyle(charCount, content) {
            const textarea = document.getElementById('activation-code');
            
            // ç§»é™¤æ‰€æœ‰æ ·å¼ç±»
            textarea.classList.remove('highlight-code', 'code-valid', 'code-invalid', 'code-warning');
            
            if (charCount === 0) {
                return;
            }
            
            // æ·»åŠ é«˜äº®
            textarea.classList.add('highlight-code');
            
            // åˆ†å‰²å¤šè¡ŒéªŒè¯
            const codes = content.split('\n').filter(line => line.trim());
            
            if (codes.length === 0) return;
            
            let allValid = true;
            let hasInvalid = false;
            let hasWarning = false;
            
            for (const code of codes) {
                const trimmed = code.trim();
                if (trimmed.length === 0) continue;
                
                if (trimmed.length < 8) {
                    hasInvalid = true;
                    break;
                }
                
                if (!/^[A-Za-z0-9]+$/.test(trimmed)) {
                    hasInvalid = true;
                    break;
                }
                
                if (trimmed.length < 16 || trimmed.length > 32) {
                    hasWarning = true;
                }
            }
            
            if (hasInvalid) {
                textarea.classList.add('code-invalid');
            } else if (hasWarning) {
                textarea.classList.add('code-warning');
            } else {
                textarea.classList.add('code-valid');
            }
        }
        
        // åˆå§‹åŒ–æ–‡æœ¬æ¡†ç›‘å¬å™¨
        function initTextareaListeners() {
            const textarea = document.getElementById('activation-code');
            
            // è¾“å…¥æ—¶è°ƒæ•´é«˜åº¦
            textarea.addEventListener('input', function() {
                autoResizeTextarea();
                validateActivationCode();
            });
            
            // ç²˜è´´æ—¶è°ƒæ•´é«˜åº¦ï¼ˆå»¶è¿Ÿç¡®ä¿å†…å®¹å·²ç²˜è´´ï¼‰
            textarea.addEventListener('paste', function(e) {
                setTimeout(() => {
                    autoResizeTextarea();
                    validateActivationCode();
                }, 10);
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´
            window.addEventListener('resize', autoResizeTextarea);
            
            // èšç„¦æ—¶è‡ªåŠ¨è°ƒæ•´
            textarea.addEventListener('focus', autoResizeTextarea);
            
            // åˆå§‹åŒ–è°ƒæ•´
            setTimeout(() => {
                autoResizeTextarea();
                // å¦‚æœæœ‰å†å²è®°å½•ï¼Œæ¢å¤å†…å®¹
                const savedCode = localStorage.getItem('last_activation_code');
                if (savedCode) {
                    textarea.value = savedCode;
                    autoResizeTextarea();
                }
            }, 100);
        }
        
        // éªŒè¯æ¿€æ´»ç æ ¼å¼
        function validateActivationCode() {
            const textarea = document.getElementById('activation-code');
            const code = textarea.value.trim();
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('last_activation_code', code);
            
            // å…ˆæ›´æ–°æ ·å¼
            autoResizeTextarea();
            
            if (!code) {
                return false;
            }
            
            // åˆ†å‰²å¤šè¡Œæ¿€æ´»ç 
            const codes = code.split('\n').filter(line => line.trim());
            
            if (codes.length === 0) {
                return false;
            }
            
            // éªŒè¯æ¯ä¸€è¡Œ
            for (let i = 0; i < codes.length; i++) {
                const singleCode = codes[i].trim();
                
                if (singleCode.length < 8) {
                    showResult(`ç¬¬ ${i + 1} è¡Œæ¿€æ´»ç é•¿åº¦ä¸è¶³ï¼ˆè‡³å°‘8ä½ï¼‰`, 'error');
                    return false;
                }
                
                if (!/^[A-Za-z0-9]+$/.test(singleCode)) {
                    showResult(`ç¬¬ ${i + 1} è¡ŒåŒ…å«éæ³•å­—ç¬¦ï¼ˆåªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰`, 'error');
                    return false;
                }
            }
            
            return true;
        }
        
        // ä¸»é€»è¾‘
        function main() {
            const params = getUrlParams();
            let sessionId = params.session || '';
            let tvIp = params.ip || '';
            
            // å¦‚æœå‚æ•°ä¸­æ²¡æœ‰ï¼Œå°è¯•ä»äºŒç»´ç å†…å®¹è§£æ
            if (!sessionId && !tvIp) {
                // å°è¯•è§£æå½“å‰URLçš„hashéƒ¨åˆ†
                const hash = window.location.hash.substring(1);
                if (hash) {
                    const parts = hash.split(':');
                    if (parts.length >= 2) {
                        sessionId = parts[0];
                        tvIp = '255.255.255.255'; // å¹¿æ’­åœ°å€
                    }
                }
            }
            
            // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
            document.getElementById('session-id').textContent = sessionId || 'æœªè¯†åˆ«';
            document.getElementById('tv-ip').textContent = tvIp || 'å¹¿æ’­æ¨¡å¼';
            
            // è‡ªåŠ¨æµ‹è¯•è¿æ¥
            if (sessionId) {
                setTimeout(testConnection, 500);
            }
            
            // åˆå§‹åŒ–æ–‡æœ¬æ¡†ç›‘å¬å™¨
            initTextareaListeners();
            
            // æ¿€æ´»ç è¾“å…¥æ¡†è‡ªåŠ¨èšç„¦
            setTimeout(() => {
                document.getElementById('activation-code').focus();
            }, 300);
        }
        
        // æµ‹è¯•ç”µè§†è¿æ¥
        async function testConnection() {
            showLoading('æ­£åœ¨æµ‹è¯•ç”µè§†è¿æ¥...');
            updateStatus('æµ‹è¯•è¿æ¥ä¸­...', '#faad14');
            
            try {
                const sessionId = document.getElementById('session-id').textContent;
                
                // å°è¯•å‘é€æµ‹è¯•æ•°æ®
                const result = await sendUdpData(sessionId + ':TEST', '255.255.255.255', 8888);
                
                if (result.success) {
                    updateStatus('ç”µè§†åœ¨çº¿ âœ“', '#52c41a');
                    showResult('ç”µè§†è¿æ¥æ­£å¸¸ï¼Œå¯ä»¥å‘é€æ¿€æ´»ç ', 'success');
                } else {
                    updateStatus('ç”µè§†å¯èƒ½ä¸åœ¨çº¿', '#ff4d4f');
                    showResult('æ— æ³•è¿æ¥åˆ°ç”µè§†ï¼Œè¯·ç¡®ä¿ç”µè§†å·²æ‰“å¼€æ¿€æ´»ç•Œé¢', 'error');
                }
                
            } catch (error) {
                updateStatus('è¿æ¥å¤±è´¥', '#ff4d4f');
                showResult('æµ‹è¯•è¿æ¥å¤±è´¥ï¼š' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // å‘é€æ¿€æ´»ç ï¼ˆæ”¯æŒå¤šè¡Œï¼‰
        async function sendActivation() {
            if (!validateActivationCode()) {
                showResult('è¯·å…ˆè¾“å…¥æœ‰æ•ˆçš„æ¿€æ´»ç ', 'error');
                return;
            }
            
            const sessionId = document.getElementById('session-id').textContent;
            const activationCode = document.getElementById('activation-code').value.trim();
            const tvIp = document.getElementById('tv-ip').textContent;
            
            // åˆ†å‰²å¤šè¡Œæ¿€æ´»ç 
            const codes = activationCode.split('\n').filter(line => line.trim());
            
            if (codes.length === 0) {
                showResult('æ²¡æœ‰æœ‰æ•ˆçš„æ¿€æ´»ç ', 'error');
                return;
            }
            
            showLoading(codes.length > 1 ? 
                `æ­£åœ¨å‘é€ ${codes.length} ä¸ªæ¿€æ´»ç ...` : 
                'æ­£åœ¨å‘é€æ¿€æ´»ç ...');
            
            try {
                let successCount = 0;
                let failCount = 0;
                
                // é€ä¸ªå‘é€æ¿€æ´»ç 
                for (let i = 0; i < codes.length; i++) {
                    const singleCode = codes[i].trim();
                    
                    // æ›´æ–°åŠ è½½æç¤º
                    if (codes.length > 1) {
                        document.getElementById('loading-text').textContent = 
                            `æ­£åœ¨å‘é€æ¿€æ´»ç  ${i + 1}/${codes.length}...`;
                    }
                    
                    // æ„é€ å‘é€æ•°æ®ï¼šSESSION_ID:ACTIVATION_CODE
                    const data = sessionId + ':' + singleCode;
                    
                    // å‘é€UDPæ•°æ®
                    const result = await sendUdpData(data, tvIp, 8888);
                    
                    if (result.success) {
                        successCount++;
                        
                        // å•æ¿€æ´»ç ç«‹å³æ˜¾ç¤ºæˆåŠŸ
                        if (codes.length === 1) {
                            showResult('âœ… æ¿€æ´»ç å‘é€æˆåŠŸï¼<br>ç”µè§†æ­£åœ¨éªŒè¯ï¼Œè¯·æŸ¥çœ‹ç”µè§†å±å¹•...', 'success');
                            updateStatus('æ¿€æ´»ç å·²å‘é€ âœ“', '#52c41a');
                            
                            // æ¸…ç©ºè¾“å…¥æ¡†
                            document.getElementById('activation-code').value = '';
                            autoResizeTextarea();
                            localStorage.removeItem('last_activation_code');
                        }
                        
                        // å»¶è¿Ÿå‘é€ä¸‹ä¸€ä¸ªï¼ˆå¦‚æœæœ‰å¤šä¸ªï¼‰
                        if (i < codes.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                        
                    } else {
                        failCount++;
                        if (codes.length === 1) {
                            showResult('âŒ å‘é€å¤±è´¥ï¼š' + result.message, 'error');
                            updateStatus('å‘é€å¤±è´¥', '#ff4d4f');
                        }
                    }
                }
                
                // å¤šæ¿€æ´»ç ç»“æœæ±‡æ€»
                if (codes.length > 1) {
                    if (successCount === codes.length) {
                        showResult(`âœ… æˆåŠŸå‘é€ ${successCount} ä¸ªæ¿€æ´»ç ï¼<br>ç”µè§†æ­£åœ¨éªŒè¯ï¼Œè¯·æŸ¥çœ‹ç”µè§†å±å¹•...`, 'success');
                        updateStatus('æ‰€æœ‰æ¿€æ´»ç å·²å‘é€ âœ“', '#52c41a');
                        
                        // æ¸…ç©ºè¾“å…¥æ¡†
                        document.getElementById('activation-code').value = '';
                        autoResizeTextarea();
                        localStorage.removeItem('last_activation_code');
                    } else if (successCount > 0) {
                        showResult(`âš ï¸ æˆåŠŸå‘é€ ${successCount} ä¸ªï¼Œå¤±è´¥ ${failCount} ä¸ªæ¿€æ´»ç `, 'info');
                        updateStatus('éƒ¨åˆ†æ¿€æ´»ç å‘é€å¤±è´¥', '#faad14');
                    } else {
                        showResult('âŒ æ‰€æœ‰æ¿€æ´»ç å‘é€å¤±è´¥', 'error');
                        updateStatus('å‘é€å¤±è´¥', '#ff4d4f');
                    }
                }
                
                // 3ç§’åè·³è½¬
                if (successCount > 0) {
                    setTimeout(() => {
                        window.location.href = 'about:blank';
                    }, 3000);
                }
                
            } catch (error) {
                showResult('å‘é€é”™è¯¯ï¼š' + error.message, 'error');
                updateStatus('å‘é€é”™è¯¯', '#ff4d4f');
            } finally {
                hideLoading();
            }
        }
        
        // å‘é€UDPæ•°æ®çš„å‡½æ•°
        function sendUdpData(data, ip, port) {
            return new Promise((resolve) => {
                try {
                    // æ¨¡æ‹Ÿå‘é€æˆåŠŸï¼ˆå®é™…ä½¿ç”¨æ—¶éœ€è¦æ›¿æ¢ä¸ºçœŸå®UDPå‘é€é€»è¾‘ï¼‰
                    console.log('å‘é€UDPæ•°æ®:', { data, ip, port });
                    
                    // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                    setTimeout(() => {
                        // æ¨¡æ‹ŸæˆåŠŸç‡90%
                        const success = Math.random() > 0.1;
                        resolve({ 
                            success: success, 
                            message: success ? 'å‘é€æˆåŠŸ' : 'ç½‘ç»œé”™è¯¯' 
                        });
                    }, 800);
                    
                } catch (error) {
                    resolve({ success: false, message: error.message });
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œ
        document.addEventListener('DOMContentLoaded', main);
        
        // æ·»åŠ å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // Ctrl+Enter å‘é€æ¿€æ´»ç 
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                sendActivation();
            }
            
            // Esc æ¸…ç©ºè¾“å…¥æ¡†
            if (e.key === 'Escape') {
                document.getElementById('activation-code').value = '';
                autoResizeTextarea();
                localStorage.removeItem('last_activation_code');
            }
        });
    </script>
</body>
</html>
