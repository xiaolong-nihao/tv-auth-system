<!DOCTYPE html>
<html>
<head>
    <title>TVè®¾å¤‡æˆæƒç®¡ç†</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #007cba; padding-bottom: 10px; }
        .device-item { padding: 12px; border: 1px solid #ddd; margin: 8px 0; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; background: #fafafa; }
        .device-id { font-family: 'Courier New', monospace; background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 14px; }
        button { padding: 8px 16px; margin: 0 5px; cursor: pointer; border: none; border-radius: 4px; font-size: 14px; transition: background 0.3s; }
        .add-btn { background: #28a745; color: white; }
        .add-btn:hover { background: #218838; }
        .remove-btn { background: #dc3545; color: white; }
        .remove-btn:hover { background: #c82333; }
        .copy-btn { background: #007cba; color: white; }
        .copy-btn:hover { background: #0056b3; }
        .refresh-btn { background: #6c757d; color: white; }
        .refresh-btn:hover { background: #545b62; }
        .add-form { background: #e7f3ff; padding: 20px; margin: 20px 0; border-radius: 6px; border-left: 4px solid #007cba; }
        input[type="text"] { padding: 10px; width: 400px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; margin-right: 10px; }
        .stats { background: #fff3cd; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #ffc107; }
        .instructions { background: #d1ecf1; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #17a2b8; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .error { color: red; padding: 10px; background: #fee; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± TVè®¾å¤‡æˆæƒç®¡ç†ç³»ç»Ÿ</h1>
        
        <div class="stats">
            <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
            <p>å·²æˆæƒè®¾å¤‡: <strong id="deviceCount">0</strong> å°</p>
            <p>æœ€åæ›´æ–°: <span id="lastUpdate">-</span></p>
            <button class="refresh-btn" onclick="loadDevices()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
        </div>

        <div class="add-form">
            <h3>â• æ·»åŠ æ–°è®¾å¤‡</h3>
            <input type="text" id="newDeviceId" placeholder="è¾“å…¥è®¾å¤‡IDï¼Œå¦‚ï¼šTV_1700000000000_abc123">
            <button class="add-btn" onclick="addDevice()">æ·»åŠ æˆæƒ</button>
            <button class="copy-btn" onclick="generateDeviceId()">ç”Ÿæˆè®¾å¤‡ID</button>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <p>1. ç”¨æˆ·æ‰“å¼€TVè½¯ä»¶ï¼Œåœ¨ç•Œé¢ä¸­æ‰¾åˆ°è®¾å¤‡ID</p>
            <p>2. å°†è®¾å¤‡IDåœ¨æ­¤é¡µé¢æ·»åŠ æˆæƒ</p>
            <p>3. ç”¨æˆ·é‡å¯TVè½¯ä»¶å³å¯çœ‹åˆ°å®Œæ•´å†…å®¹</p>
            <p>4. å¯éšæ—¶åˆ é™¤è®¾å¤‡æˆæƒ</p>
            <p><strong>æ³¨æ„ï¼š</strong>æ·»åŠ /åˆ é™¤è®¾å¤‡éœ€è¦åœ¨GitHubé¡µé¢æ‰‹åŠ¨ç¼–è¾‘æ–‡ä»¶</p>
        </div>

        <div>
            <h3>ğŸ“‹ å·²æˆæƒè®¾å¤‡åˆ—è¡¨</h3>
            <div id="deviceList" class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script>
        // ğŸ”§ é…ç½®åŒºï¼šæ›¿æ¢ä¸ºä½ çš„GitHubç”¨æˆ·å
        const GITHUB_USERNAME = 'YOUR_GITHUB_USERNAME';
        const AUTH_URL = `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/tv-auth-system/auth-list.json`;
        
        // åŠ è½½è®¾å¤‡åˆ—è¡¨
        async function loadDevices() {
            try {
                document.getElementById('deviceList').innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
                
                const response = await fetch(AUTH_URL + '?t=' + Date.now());
                if (!response.ok) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + response.status);
                }
                const data = await response.json();
                
                displayDevices(data.authorized_devices);
                updateStats(data);
                
            } catch (error) {
                document.getElementById('deviceList').innerHTML = 
                    '<div class="error">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
                console.error('åŠ è½½é”™è¯¯:', error);
            }
        }
        
        // æ˜¾ç¤ºè®¾å¤‡åˆ—è¡¨
        function displayDevices(devices) {
            const deviceList = document.getElementById('deviceList');
            
            if (devices.length === 0) {
                deviceList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">æš‚æ— æˆæƒè®¾å¤‡</div>';
                return;
            }
            
            deviceList.innerHTML = devices.map(device => `
                <div class="device-item">
                    <span class="device-id">${device}</span>
                    <div>
                        <button class="copy-btn" onclick="copyDeviceId('${device}')">å¤åˆ¶</button>
                        <button class="remove-btn" onclick="removeDevice('${device}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(data) {
            document.getElementById('deviceCount').textContent = data.authorized_devices.length;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
        }
        
        // æ·»åŠ è®¾å¤‡
        function addDevice() {
            const deviceId = document.getElementById('newDeviceId').value.trim();
            if (!deviceId) {
                alert('è¯·è¾“å…¥è®¾å¤‡ID');
                return;
            }
            
            if (!validateDeviceId(deviceId)) {
                alert('è®¾å¤‡IDæ ¼å¼ä¸æ­£ç¡®ï¼\næ­£ç¡®æ ¼å¼ï¼šTV_æ—¶é—´æˆ³_éšæœºå­—ç¬¦\nç¤ºä¾‹ï¼šTV_1700000000000_abc123def');
                return;
            }
            
            const editUrl = `https://github.com/${GITHUB_USERNAME}/tv-auth-system/edit/main/auth-list.json`;
            
            const message = `è¯·æ‰‹åŠ¨æ·»åŠ è®¾å¤‡æˆæƒï¼š\n\n1. ç‚¹å‡»ç¡®å®šåæ‰“å¼€GitHubç¼–è¾‘é¡µé¢\n2. åœ¨ "authorized_devices" æ•°ç»„ä¸­æ·»åŠ : "${deviceId}"\n3. æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç‚¹å‡» "Commit changes" æäº¤\n\nè®¾å¤‡ID: ${deviceId}`;
            
            if (confirm(message)) {
                window.open(editUrl, '_blank');
            }
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('newDeviceId').value = '';
        }
        
        // åˆ é™¤è®¾å¤‡
        function removeDevice(deviceId) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤è®¾å¤‡æˆæƒå—ï¼Ÿ\n\nè®¾å¤‡ID: ${deviceId}`)) {
                return;
            }
            
            const editUrl = `https://github.com/${GITHUB_USERNAME}/tv-auth-system/edit/main/auth-list.json`;
            const message = `è¯·æ‰‹åŠ¨åˆ é™¤è®¾å¤‡æˆæƒï¼š\n\n1. ç‚¹å‡»ç¡®å®šåæ‰“å¼€GitHubç¼–è¾‘é¡µé¢\n2. ä» "authorized_devices" æ•°ç»„ä¸­åˆ é™¤: "${deviceId}"\n3. æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç‚¹å‡» "Commit changes" æäº¤`;
            
            alert(message);
            window.open(editUrl, '_blank');
        }
        
        // ç”Ÿæˆè®¾å¤‡ID
        function generateDeviceId() {
            const deviceId = 'TV_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
            document.getElementById('newDeviceId').value = deviceId;
            document.getElementById('newDeviceId').select();
        }
        
        // å¤åˆ¶è®¾å¤‡ID
        function copyDeviceId(deviceId) {
            navigator.clipboard.writeText(deviceId).then(() => {
                alert('å·²å¤åˆ¶è®¾å¤‡ID: ' + deviceId);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        // éªŒè¯è®¾å¤‡IDæ ¼å¼
        function validateDeviceId(deviceId) {
            const pattern = /^TV_\d+_[a-zA-Z0-9]{8}$/;
            return pattern.test(deviceId);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadDevices();
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(loadDevices, 30000);
        });
    </script>
</body>
</html>
