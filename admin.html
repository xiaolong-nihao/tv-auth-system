<!DOCTYPE html>
<html>
<head>
    <title>ç³»ç»Ÿè®¾ç½® - TVè®¾å¤‡æˆæƒç®¡ç†</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #007cba; padding-bottom: 10px; }
        .section { margin: 25px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 6px; background: #fafafa; }
        .section h3 { margin-top: 0; color: #007cba; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; margin-right: 15px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #28a745; }
        input:checked + .slider:before { transform: translateX(26px); }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], input[type="url"] { padding: 10px; width: 100%; max-width: 500px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; font-size: 14px; }
        .save-btn { background: #28a745; color: white; }
        .refresh-btn { background: #007cba; color: white; }
        .cleanup-btn { background: #dc3545; color: white; }
        .back-btn { background: #6c757d; color: white; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 6px; border-left: 4px solid #007cba; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-value { font-size: 24px; font-weight: bold; color: #007cba; }
        .danger-zone { border-color: #dc3545; background: #f8d7da; }
        .success-message { background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error-message { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½® - TVè®¾å¤‡æˆæƒç®¡ç†</h1>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="section">
            <h3>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h3>
            <div class="stats-grid" id="statistics">
                <div class="stat-card">
                    <div>æ€»è®¿é—®é‡</div>
                    <div class="stat-value" id="totalAccess">0</div>
                </div>
                <div class="stat-card">
                    <div>æˆæƒè®¿é—®</div>
                    <div class="stat-value" id="authorizedAccess">0</div>
                </div>
                <div class="stat-card">
                    <div>æœªæˆæƒè®¿é—®</div>
                    <div class="stat-value" id="unauthorizedAccess">0</div>
                </div>
                <div class="stat-card">
                    <div>æœ€åæ¸…ç†</div>
                    <div class="stat-value" id="lastCleanup">-</div>
                </div>
            </div>
            <button class="refresh-btn" onclick="loadStatistics()">ğŸ”„ åˆ·æ–°ç»Ÿè®¡</button>
        </div>

        <!-- ç³»ç»Ÿé…ç½® -->
        <div class="section">
            <h3>ğŸ”§ ç³»ç»Ÿé…ç½®</h3>
            <div class="form-group">
                <label class="switch">
                    <input type="checkbox" id="deleteProtection">
                    <span class="slider"></span>
                </label>
                <label for="deleteProtection" style="display: inline;">é˜²è¯¯åˆ å¼€å…³</label>
            </div>
            
            <div class="form-group">
                <label class="switch">
                    <input type="checkbox" id="autoCleanup">
                    <span class="slider"></span>
                </label>
                <label for="autoCleanup" style="display: inline;">è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®¾å¤‡</label>
            </div>
            
            <div class="form-group">
                <label for="cleanupDays">æ¸…ç†å¤©æ•°:</label>
                <input type="number" id="cleanupDays" min="1" max="365" value="30">
                <small>è®¾å¤‡è¶…è¿‡æŒ‡å®šå¤©æ•°æœªè®¿é—®è‡ªåŠ¨æ¸…ç†</small>
            </div>
            
            <div class="form-group">
                <label for="realContentUrl">çœŸå®å†…å®¹åœ°å€:</label>
                <input type="url" id="realContentUrl" placeholder="https://raw.githubusercontent.com/.../cangku.json">
            </div>
            
            <div class="form-group">
                <label for="demoContentUrl">æ¼”ç¤ºå†…å®¹åœ°å€:</label>
                <input type="url" id="demoContentUrl" placeholder="https://gitee.com/.../cangku.json">
            </div>
            
            <button class="save-btn" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            <button class="refresh-btn" onclick="loadConfig()">ğŸ”„ åˆ·æ–°é…ç½®</button>
        </div>

        <!-- æ•°æ®ç®¡ç† -->
        <div class="section danger-zone">
            <h3>ğŸ—‘ï¸ æ•°æ®ç®¡ç†</h3>
            <div class="form-group">
                <button class="cleanup-btn" onclick="manualCleanup()">ğŸ§¹ ç«‹å³æ¸…ç†è¿‡æœŸè®¾å¤‡</button>
                <small>æ¸…ç†è¶…è¿‡æŒ‡å®šå¤©æ•°æœªè®¿é—®çš„è®¾å¤‡</small>
            </div>
            
            <div class="form-group">
                <button class="cleanup-btn" onclick="resetStatistics()">ğŸ“Š é‡ç½®ç»Ÿè®¡ä¿¡æ¯</button>
                <small>å°†è®¿é—®ç»Ÿè®¡å½’é›¶</small>
            </div>
        </div>

        <!-- æ¶ˆæ¯æ˜¾ç¤º -->
        <div id="messageArea"></div>

        <!-- å¯¼èˆª -->
        <div class="section">
            <button class="back-btn" onclick="goToAdmin()">â† è¿”å›ç®¡ç†é¡µé¢</button>
        </div>
    </div>

    <script>
        // é…ç½®
        const GITHUB_USERNAME = 'ä½ çš„GitHubç”¨æˆ·å';
        const CONFIG_URL = `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/tv-auth-system/config.json`;
        const AUTH_URL = `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/tv-auth-system/auth-list.json`;
        
        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                showMessage('æ­£åœ¨åŠ è½½é…ç½®...', 'info');
                
                const response = await fetch(CONFIG_URL + '?t=' + Date.now());
                const data = await response.json();
                
                // æ›´æ–°è¡¨å•
                document.getElementById('deleteProtection').checked = data.system_config.delete_protection;
                document.getElementById('autoCleanup').checked = data.system_config.auto_cleanup;
                document.getElementById('cleanupDays').value = data.system_config.cleanup_days;
                document.getElementById('realContentUrl').value = data.system_config.real_content_url;
                document.getElementById('demoContentUrl').value = data.system_config.demo_content_url;
                
                showMessage('é…ç½®åŠ è½½æˆåŠŸ', 'success');
                
            } catch (error) {
                showMessage('åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // åŠ è½½ç»Ÿè®¡
        async function loadStatistics() {
            try {
                const response = await fetch(CONFIG_URL + '?t=' + Date.now());
                const data = await response.json();
                
                const stats = data.access_statistics;
                document.getElementById('totalAccess').textContent = stats.total_access;
                document.getElementById('authorizedAccess').textContent = stats.authorized_access;
                document.getElementById('unauthorizedAccess').textContent = stats.unauthorized_access;
                document.getElementById('lastCleanup').textContent = 
                    new Date(stats.last_cleanup).toLocaleDateString();
                    
            } catch (error) {
                showMessage('åŠ è½½ç»Ÿè®¡å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // ä¿å­˜é…ç½®
        async function saveConfig() {
            try {
                const config = {
                    delete_protection: document.getElementById('deleteProtection').checked,
                    auto_cleanup: document.getElementById('autoCleanup').checked,
                    cleanup_days: parseInt(document.getElementById('cleanupDays').value),
                    real_content_url: document.getElementById('realContentUrl').value,
                    demo_content_url: document.getElementById('demoContentUrl').value
                };
                
                const editUrl = `https://github.com/${GITHUB_USERNAME}/tv-auth-system/edit/main/config.json`;
                
                alert(`è¯·æ‰‹åŠ¨æ›´æ–°é…ç½®ï¼š\n\n1. ç‚¹å‡»ç¡®å®šåæ‰“å¼€GitHubç¼–è¾‘é¡µé¢\n2. æ›´æ–° system_config éƒ¨åˆ†\n3. ç‚¹å‡» Commit changes æäº¤\n\né…ç½®å†…å®¹:\n${JSON.stringify(config, null, 2)}`);
                
                window.open(editUrl, '_blank');
                showMessage('è¯·åœ¨GitHubé¡µé¢æ›´æ–°é…ç½®', 'info');
                
            } catch (error) {
                showMessage('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ‰‹åŠ¨æ¸…ç†è¿‡æœŸè®¾å¤‡
        async function manualCleanup() {
            if (!confirm('ç¡®å®šè¦æ¸…ç†è¿‡æœŸè®¾å¤‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) return;
            
            const editUrl = `https://github.com/${GITHUB_USERNAME}/tv-auth-system/edit/main/auth-list.json`;
            alert('è¯·åœ¨GitHubç¼–è¾‘é¡µé¢æ‰‹åŠ¨æ¸…ç†è¿‡æœŸè®¾å¤‡ï¼š\n\n1. åˆ é™¤è¿‡æœŸçš„è®¾å¤‡è®°å½•\n2. æ›´æ–° metadata.total_devices\n3. æäº¤æ›´æ”¹');
            
            window.open(editUrl, '_blank');
        }
        
        // é‡ç½®ç»Ÿè®¡
        async function resetStatistics() {
            if (!confirm('ç¡®å®šè¦é‡ç½®ç»Ÿè®¡ä¿¡æ¯å—ï¼Ÿ')) return;
            
            const editUrl = `https://github.com/${GITHUB_USERNAME}/tv-auth-system/edit/main/config.json`;
            alert('è¯·åœ¨GitHubç¼–è¾‘é¡µé¢é‡ç½®ç»Ÿè®¡ï¼š\n\n1. å°† access_statistics ä¸­çš„æ•°å€¼å½’é›¶\n2. æ›´æ–° last_cleanup æ—¶é—´\n3. æäº¤æ›´æ”¹');
            
            window.open(editUrl, '_blank');
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            const className = type === 'success' ? 'success-message' : 
                            type === 'error' ? 'error-message' : 'info-message';
            
            messageArea.innerHTML = `<div class="${className}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 3000);
            }
        }
        
        // è¿”å›ç®¡ç†é¡µé¢
        function goToAdmin() {
            window.location.href = `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/tv-auth-system/admin.html`;
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            loadStatistics();
        });
    </script>
</body>
</html>
